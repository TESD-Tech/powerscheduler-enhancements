~[tlist_sql;
SELECT COALESCE(JSON_ARRAYAGG(
		JSON_OBJECT( * RETURNING CLOB)
    RETURNING CLOB
	), TO_CLOB(CHR(91) || CHR(93)) ) json_obj
FROM (
SELECT SCHEDULECOURSECATALOGS.DCID
	, SCHEDULECOURSECATALOGS.COURSE_NUMBER
	, TO_CHAR( SCHEDULECOURSECATALOGS.SCHED_FULLCATALOGDESCRIPTION ) SCHED_FULLCATALOGDESCRIPTION
	, SUM( CASE WHEN SCHEDULEREQUESTS.COURSENUMBER IS NOT NULL THEN 1 ELSE 0 END ) requests
FROM SCHEDULECOURSECATALOGS
	LEFT JOIN SCHEDULEREQUESTS ON SCHEDULEREQUESTS.YEARID = ~(curyearid)00
		AND SCHEDULEREQUESTS.SCHOOLID = SCHEDULECOURSECATALOGS.SCHOOLID
		AND SCHEDULEREQUESTS.COURSENUMBER = SCHEDULECOURSECATALOGS.COURSE_NUMBER
WHERE SCHEDULECOURSECATALOGS.schoolid = ~(curschoolid)
 	AND SCHEDULECOURSECATALOGS.COURSECATALOGID = ~[x:scheduleinfo;curcatalogid]
GROUP BY SCHEDULECOURSECATALOGS.DCID
	, SCHEDULECOURSECATALOGS.COURSE_NUMBER
	, TO_CHAR( SCHEDULECOURSECATALOGS.SCHED_FULLCATALOGDESCRIPTION )
) courses
;nonemessage=[]]~(json_obj)[/tlist_sql]
